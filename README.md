# housing-market-abm-public
Public version of the agent-based housing market model developed at Magyar Nemzeti Bank, which can be run by artificial data


This git repository contains the code to run the agent-based housing market model developed by the Central Bank of Hungary. We made this code public to help other researchers experiment with the code, and adapt it to their own available datasets. Published results generated by the code were run using granular data which can not be shared, but we provide sample data to be able to run the code. Since the sample data has not been generated by using empirical distributions, it does not generate the same trends as the published results.
To generate your own input data in the right format for this code, please section Necessary structure of input files
In some cases the code contains some more detailed rules (and more parameters) than what could be written down in the original article, because sharing all the details would have made the original article untraceable. So for the exact details please refer to the code.
To mention a few:
-        regarding the bridge loan, if the flat to be sold is still a collateral of a mortgage loan and the outstanding principal is greater then the maximum allowable amount of bridge loan, then no bridge loan can be granted on the flat
-        to avoid some unnecessary demand shocks, households with a single individual below a certain age will not necessarily rent a flat even if they could afford it (see parameter ageInYearsToConsiderSomebodyOldEnoughToRentForSure)

 
SOME REMARKS ON THE CODE AND HOW TO RUN IT
-        the MainRun class contains the entry code for the program. In MainRun, by setting the runMode, one can run the code in 3 + 2 different ways:
- 1) one or more simulations are run (in the latter case sequentially). It calls the multipleRuns() function where one can set the number of simulations to be run.
- 2) the program loads the results of a previous run (defined in pathNameForOutputDataCsv)
- 3) the program loads the results of previous runs in a selected folder and for each run it prints some selected time series in single csv files (which later can be processed in any way). The time series to be printed can be changed in Model. printGivenSeriesToCsv()
- 4) the program generates simulated input data (csv files, see the NECESSARY STRUCTURE OF INPUT FILES section)
- 5) to rescale the model, one can regenerate input data csv files (into a given folder) and use these csv files in later simulations
-        The parameters of the Model can be defined in a .properties file – like in configInternational.properties. If you would like to make a different .properties file, please define all parameter values contained in configInternational.properties. The properties file to use can be set in MainRun.configFileName
-        The code contains some Hungary specific parts (like government subsidy for newly built flats for families). Variables related to these parts contain names with CSOK, ZOP or babyLoan. Feel free to skip the parts of the code related to these variables. In the configInternational.properties we set the variables related to these specificities to 0 (or in such a way that the simulation runs would omit any effect of these specificities).
-        All individuals, households, buckets, neighbourhoods and geoLocations have a unique id.
-        Some parts may contain nonparameterized variables (ie. see calculatePTILimit function)  
 

 
OUTPUT DATA
To save and analyze data generated by the model, we introduced two-dimensional arrays called outputData for buckets, neighbourhoods, geoLocations and for the static Model class. Each of these objects has one outputData array which can actually store time series for whatever variable the researchers would like to implement (one can look for the implementation in the code). For example, for a geoLocation outputData[1] is a one-dimensional array, the time series of the number of transactions in the housing market in the given geoLocation, while outputData[2] is the sum of the transaction prices in the given geoLocation - and so with the help of these two time series we can calculate the average prices as well – or one can simply code the time series of average transaction prices for an element of outputData. In the MainRun.java code one can specify the number of time series which can be stored by class type. We generated a huge sum of outputData series during model development, but for the sake of clarity we only left a few in the public code.
At the end of a simulation, the writeOutputDataCsv() function writes these ouputData arrays in such a format that later these data can be loaded (into proper outputData arrays).
At the beginning of a simulation run (or after loading results of a previous run), a GUI appears (coded in ModelGUI). This GUI can visualize the time series stored in the outputData arrays. In the text field left to the „Get time series” button, one can write which time series to display. The time series to be displayed needs to be separated by exactly one comma. For each time series to be displayed, use the following notation: XN.V where X stands for the type of variable (b for Bucket, n for Neighbourhood, l for GeoLocation and m for Model), N stands for the unique id of the specific object and V stands for the number of time series in the outputData array of the specific object, i.e. l1.2 represents outputData[2] of the geoLocation with id 1. If we omit „N.” in „XN.V” (so using the form „XV”), then the sum of the time series for each object in type X is displayed, i.e. „l1” would display the number of all transactions countrywide. Since Model does not have an id, to refer to a time series in Model, we also need to use the form „XV”, i.e „m2”. In the text field do not use „”, just the code.
To access some queries faster, 36 buttons were displayed, and clicking on any of these would display the time series coded on its label. (You can edit the labels in ModelGUI.java)
Some complex time series can also be generated. The GUI is capable of handling the following operations: +, -, * and /, but it always evaluates from left tot he right (so * and / has no precedence and yet no parentheses may be used). However, constants can also be used in the formulas. For example, l0.2/l2*100 represents the share of geoLocation with id 2 in all the transactions in percentage points.
In the GUI you can change the periods for which the time series are displayed („From” and „To”). Remember that the simulation starts with period 0. By checking „Print to console”, the results will be printed to the console and you can copy-paste it.
In OutputDataNames.java you can specify the names of the time series to be displayed in the figure labels (see updateOutputDataNames() method). Without specifying a specific name the number of the time series is displayed.
 
NECESSARY STRUCTURE OF INPUT FILES
Besides the parameters, input data are loaded from csv files. The sample resources folder contains the necessary csv files and may help other users to generate their own input csv files. The households.csv, individuals.csv, flats.csv and loanContracts.csv files contain data to generate the initial households, individuals, flats and loan contracts, including the necessary connections between these entities (referencing with unique ids); absoluteUtilityParameters.csv contains the value of the parameters of the utility function for all households; birthProbability.csv, marriageProbability.csv, deathProbability.csv and marriageData.csv contain data for demographic events during simulation runs; priceIndex.csv contains price index time series at neighbourhood level; priceRegression.csv contains estimated regression coefficients at neighbourhood level; transactions.csv contains data to generate initial flatSaleRecord data (flatSaleRecord data are updated every period and are used for flat pricing); externalDemand.csv contains time series for external demand at bucket level during simulation runs; newlyBuilt.csv contains data about transactions of newly built flats for the last two years preceding the beginning of the simulation and is used to generate the initial flats under construction (or ready but not sold flats of the construction sector); macroPath.csv contains the time series of macro variables used during the simulation.
The InputDataGenerator class generates all the input csv files with fictive data based on some parameters which can be set and it may help other users to identify the necessary structure of input files. Since input data generation consists of calibrating the utility parameter functions for households one-by-one, in the case of 100,000 households it can take a few hours (depending on the hardware and the number of threads used. The number of threads to use is an attribute of Model class (nThreads) which can be changed in the code).
 
CONTACT
Since we have not yet written a detailed documentation on the code, feel free to contact Bence Mérő (merob@mnb.hu), if you have any questions, especially if you wish to adapt this code to your own needs.
 
